# üé® Common Components Usage Guide

## üì¶ Components

1. **LoadingSpinner** - Hi·ªÉn th·ªã loading states
2. **ErrorBoundary** - B·∫Øt v√† x·ª≠ l√Ω l·ªói JavaScript

---

## 1. üîÑ LoadingSpinner Component

Component ƒë·ªÉ hi·ªÉn th·ªã c√°c loading states kh√°c nhau.

### Import

```javascript
import LoadingSpinner, {
  SmallSpinner,
  LargeSpinner,
  FullScreenSpinner,
  DotsLoader,
  PulseLoader,
  BarsLoader,
  SkeletonLoader,
  CardSkeleton,
  JobCardSkeleton
} from './components/common/LoadingSpinner';
```

### Basic Usage

```javascript
// Default spinner
<LoadingSpinner />

// With text
<LoadingSpinner text="ƒêang t·∫£i d·ªØ li·ªáu..." />

// Different sizes
<LoadingSpinner size="small" />
<LoadingSpinner size="medium" />
<LoadingSpinner size="large" />

// Custom color
<LoadingSpinner color="#ff6b6b" />

// Full screen overlay
<LoadingSpinner fullScreen text="Vui l√≤ng ƒë·ª£i..." />
```

### Different Types

```javascript
// Spinner (default)
<LoadingSpinner type="spinner" />

// Dots animation
<LoadingSpinner type="dots" />
<DotsLoader />  {/* Shortcut */}

// Pulse animation
<LoadingSpinner type="pulse" />
<PulseLoader />  {/* Shortcut */}

// Bars animation
<LoadingSpinner type="bars" />
<BarsLoader />  {/* Shortcut */}
```

### Complete Examples

**Example 1: Simple loading state**
```javascript
function JobList() {
  const [loading, setLoading] = useState(true);
  const [jobs, setJobs] = useState([]);

  useEffect(() => {
    fetchJobs().then(data => {
      setJobs(data);
      setLoading(false);
    });
  }, []);

  if (loading) {
    return <LoadingSpinner text="ƒêang t·∫£i danh s√°ch vi·ªác l√†m..." />;
  }

  return (
    <div>
      {jobs.map(job => <JobCard key={job.id} job={job} />)}
    </div>
  );
}
```

**Example 2: Full screen loading**
```javascript
function App() {
  const [initializing, setInitializing] = useState(true);

  useEffect(() => {
    // Initialize app
    initializeApp().then(() => {
      setInitializing(false);
    });
  }, []);

  if (initializing) {
    return (
      <FullScreenSpinner 
        text="ƒêang kh·ªüi t·∫°o ·ª©ng d·ª•ng..." 
        color="#4a90e2"
      />
    );
  }

  return <MainApp />;
}
```

**Example 3: Inline loading**
```javascript
function SubmitButton({ loading }) {
  return (
    <button disabled={loading}>
      {loading ? (
        <>
          <SmallSpinner />
          <span>ƒêang x·ª≠ l√Ω...</span>
        </>
      ) : (
        'G·ª≠i ƒë∆°n'
      )}
    </button>
  );
}
```

### Skeleton Loading

Use skeleton loaders ƒë·ªÉ t·∫°o better UX khi load data.

```javascript
// Basic skeleton
<SkeletonLoader count={3} height={20} width="100%" />

// Card skeleton
function JobListSkeleton() {
  return (
    <div className="jobs-grid">
      {Array.from({ length: 6 }).map((_, idx) => (
        <JobCardSkeleton key={idx} />
      ))}
    </div>
  );
}

// Custom skeleton
<SkeletonLoader 
  count={1} 
  height={100} 
  width="80%" 
  borderRadius={8}
/>
```

**Complete skeleton example:**
```javascript
function UserProfile() {
  const [loading, setLoading] = useState(true);
  const [user, setUser] = useState(null);

  useEffect(() => {
    fetchUser().then(data => {
      setUser(data);
      setLoading(false);
    });
  }, []);

  if (loading) {
    return (
      <div className="profile-container">
        <SkeletonLoader height={120} width={120} borderRadius={60} />
        <SkeletonLoader height={24} width="60%" />
        <SkeletonLoader height={16} width="80%" count={3} />
      </div>
    );
  }

  return (
    <div className="profile-container">
      <img src={user.avatar} alt={user.name} />
      <h2>{user.name}</h2>
      <p>{user.bio}</p>
    </div>
  );
}
```

### Props Reference

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `size` | `'small' \| 'medium' \| 'large'` | `'medium'` | K√≠ch th∆∞·ªõc spinner |
| `text` | `string` | `''` | Text hi·ªÉn th·ªã d∆∞·ªõi spinner |
| `fullScreen` | `boolean` | `false` | Hi·ªÉn th·ªã full screen overlay |
| `color` | `string` | `'#4a90e2'` | M√†u c·ªßa spinner |
| `type` | `'spinner' \| 'dots' \| 'pulse' \| 'bars'` | `'spinner'` | Ki·ªÉu animation |

---

## 2. üõ°Ô∏è ErrorBoundary Component

Component ƒë·ªÉ b·∫Øt v√† x·ª≠ l√Ω l·ªói JavaScript trong React component tree.

### Import

```javascript
import ErrorBoundary, {
  withErrorBoundary,
  SimpleErrorFallback,
  MinimalErrorFallback
} from './components/common/ErrorBoundary';
```

### Basic Usage

```javascript
// Wrap to√†n b·ªô app
function App() {
  return (
    <ErrorBoundary>
      <MainApp />
    </ErrorBoundary>
  );
}

// Wrap specific components
function DashboardPage() {
  return (
    <div>
      <h1>Dashboard</h1>
      
      <ErrorBoundary>
        <StatisticsWidget />
      </ErrorBoundary>

      <ErrorBoundary>
        <ChartWidget />
      </ErrorBoundary>
    </div>
  );
}
```

### With Custom Fallback

```javascript
// Custom error UI
<ErrorBoundary 
  fallback={
    <div className="custom-error">
      <h2>Oops! Something went wrong</h2>
      <button onClick={() => window.location.reload()}>
        Reload
      </button>
    </div>
  }
>
  <YourComponent />
</ErrorBoundary>

// Using pre-built fallbacks
<ErrorBoundary fallback={<SimpleErrorFallback />}>
  <YourComponent />
</ErrorBoundary>

<ErrorBoundary fallback={<MinimalErrorFallback />}>
  <SmallWidget />
</ErrorBoundary>
```

### With Error Callback

```javascript
// Log errors to external service
<ErrorBoundary 
  onError={(error, errorInfo) => {
    // Send to Sentry, LogRocket, etc.
    console.error('Error caught:', error);
    console.error('Component stack:', errorInfo.componentStack);
    
    // Send to your backend
    fetch('/api/log-error', {
      method: 'POST',
      body: JSON.stringify({ error: error.toString(), errorInfo })
    });
  }}
>
  <YourApp />
</ErrorBoundary>
```

### With Reset Callback

```javascript
<ErrorBoundary 
  onReset={() => {
    // Clear error state
    // Navigate to safe page
    window.location.href = '/';
  }}
>
  <YourComponent />
</ErrorBoundary>
```

### Higher-Order Component

Wrap components d·ªÖ d√†ng h∆°n v·ªõi HOC.

```javascript
// Wrap component
const SafeJobList = withErrorBoundary(JobList, {
  onError: (error, errorInfo) => {
    console.error('JobList error:', error);
  }
});

// Use it
<SafeJobList />
```

### Complete Examples

**Example 1: App-level error boundary**
```javascript
// App.js
function App() {
  return (
    <ErrorBoundary
      onError={(error, errorInfo) => {
        // Log to error tracking service
        logErrorToSentry(error, errorInfo);
      }}
      onReset={() => {
        // Clear app state and redirect
        localStorage.clear();
        window.location.href = '/';
      }}
    >
      <Router>
        <Navbar />
        <Routes>
          <Route path="/" element={<HomePage />} />
          <Route path="/jobs" element={<JobsPage />} />
          {/* ... */}
        </Routes>
        <Footer />
      </Router>
    </ErrorBoundary>
  );
}
```

**Example 2: Multiple boundaries for isolation**
```javascript
function DashboardPage() {
  return (
    <div className="dashboard">
      <h1>Dashboard</h1>

      {/* N·∫øu UserStats l·ªói, ch·ªâ n√≥ b·ªã ·∫£nh h∆∞·ªüng */}
      <ErrorBoundary fallback={<MinimalErrorFallback />}>
        <UserStats />
      </ErrorBoundary>

      {/* JobsChart ƒë·ªôc l·∫≠p */}
      <ErrorBoundary fallback={<MinimalErrorFallback />}>
        <JobsChart />
      </ErrorBoundary>

      {/* RecentActivity ƒë·ªôc l·∫≠p */}
      <ErrorBoundary fallback={<MinimalErrorFallback />}>
        <RecentActivity />
      </ErrorBoundary>
    </div>
  );
}
```

**Example 3: With retry logic**
```javascript
function DataWidget() {
  const [retryCount, setRetryCount] = useState(0);

  return (
    <ErrorBoundary
      key={retryCount} // Reset boundary khi key thay ƒë·ªïi
      fallback={
        <div className="error-widget">
          <p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</p>
          <button onClick={() => setRetryCount(c => c + 1)}>
            Th·ª≠ l·∫°i ({retryCount}/3)
          </button>
        </div>
      }
    >
      <DataDisplay />
    </ErrorBoundary>
  );
}
```

**Example 4: Async error handling**
```javascript
// Note: ErrorBoundary KH√îNG b·∫Øt ƒë∆∞·ª£c:
// - Event handlers errors
// - Async code (setTimeout, promises)
// - Server-side rendering
// - Errors trong ch√≠nh ErrorBoundary

// ‚ùå KH√îNG b·∫Øt ƒë∆∞·ª£c
function BadComponent() {
  const handleClick = () => {
    throw new Error('This will NOT be caught');
  };

  return <button onClick={handleClick}>Click</button>;
}

// ‚úÖ Ph·∫£i wrap trong try-catch
function GoodComponent() {
  const [error, setError] = useState(null);

  const handleClick = () => {
    try {
      throw new Error('This is handled');
    } catch (err) {
      setError(err.message);
    }
  };

  if (error) return <div>Error: {error}</div>;

  return <button onClick={handleClick}>Click</button>;
}
```

### Props Reference

| Prop | Type | Description |
|------|------|-------------|
| `children` | `ReactNode` | Components ƒë∆∞·ª£c wrap |
| `fallback` | `ReactNode` | Custom error UI |
| `onError` | `(error, errorInfo) => void` | Callback khi c√≥ l·ªói |
| `onReset` | `() => void` | Callback khi reset |

---

## üéØ Best Practices

### LoadingSpinner

1. **Use skeleton loaders** cho better UX thay v√¨ spinner ƒë∆°n thu·∫ßn
2. **Inline loading** cho buttons v√† small actions
3. **Full screen loading** ch·ªâ d√πng cho app initialization
4. **Always provide text** ƒë·ªÉ user bi·∫øt ƒëang t·∫£i g√¨
5. **Consistent colors** v·ªõi design system c·ªßa app

### ErrorBoundary

1. **Multiple boundaries** thay v√¨ m·ªôt boundary l·ªõn
2. **Log errors** ƒë·∫øn external service (Sentry, etc.)
3. **User-friendly messages** thay v√¨ technical error
4. **Provide recovery actions** (retry, go home, reload)
5. **Test error boundaries** b·∫±ng c√°ch t·∫°o component throw error

---

## üß™ Testing

### Test ErrorBoundary

```javascript
// Create a component that throws error
function BuggyComponent() {
  throw new Error('Test error');
}

// Test
<ErrorBoundary>
  <BuggyComponent />
</ErrorBoundary>
```

### Trigger error manually

```javascript
// Add this to any component ƒë·ªÉ test
if (process.env.NODE_ENV === 'development') {
  window.triggerError = () => {
    throw new Error('Manual test error');
  };
}

// Console: window.triggerError()
```

---

## üìù File Structure

```
src/
  ‚îú‚îÄ‚îÄ components/
  ‚îÇ   ‚îî‚îÄ‚îÄ common/
  ‚îÇ       ‚îú‚îÄ‚îÄ LoadingSpinner.jsx
  ‚îÇ       ‚îú‚îÄ‚îÄ LoadingSpinner.css
  ‚îÇ       ‚îú‚îÄ‚îÄ ErrorBoundary.jsx
  ‚îÇ       ‚îî‚îÄ‚îÄ ErrorBoundary.css
```